<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    
    <!-- NuGet Package Properties -->
    <PackageId>ModularGodot.Core</PackageId>
    <Version>0.1.0</Version>
    <Authors>BananaPeel</Authors>
    <Company>BananaPeel</Company>
    <Product>ModularGodot.Core</Product>
    <Description>A modular architecture framework for Godot applications, providing clean architecture patterns with dependency injection, CQRS, and domain-driven design support.</Description>
    <PackageTags>godot;modular;architecture;clean-architecture;ddd;cqrs;dependency-injection</PackageTags>
    <RepositoryUrl>https://github.com/1264459640/ModularGodot.Core</RepositoryUrl>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
    <IncludeSymbols>true</IncludeSymbols>
    <SymbolPackageFormat>snupkg</SymbolPackageFormat>
    <IncludeReferencedProjects>true</IncludeReferencedProjects>
    <!-- 移除CopyLocalLockFileAssemblies，因为ILRepack会处理依赖项 -->
    <!-- <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies> -->
  </PropertyGroup>

  <!-- ILRepack会自动合并子项目到主DLL中，不需要手动包含 -->

  <ItemGroup>
    <!-- 保留NuGet依赖声明，用于构建时获取DLL，但不在最终包中声明为依赖 -->
    <PackageReference Include="Autofac" Version="8.4.0" PrivateAssets="all" />
    <PackageReference Include="GodotSharp" Version="4.4.1" PrivateAssets="all" />
    <PackageReference Include="ILRepack.Lib.MSBuild.Task" Version="2.0.43">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
    </PackageReference>
    <PackageReference Include="MediatR" Version="13.0.0" PrivateAssets="all" />
    <PackageReference Include="MediatR.Extensions.Autofac.DependencyInjection" Version="13.1.0" PrivateAssets="all" />
    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="9.0.7" PrivateAssets="all" />
    <PackageReference Include="Microsoft.Extensions.Caching.Memory" Version="9.0.7" PrivateAssets="all" />
    <PackageReference Include="R3" Version="1.3.0" PrivateAssets="all" />
    <PackageReference Include="System.Reactive" Version="6.0.0" PrivateAssets="all" />
  </ItemGroup>

  <ItemGroup>
    <!-- 
      ✅ 简化打包方式：
      - 通过 ProjectReference 引用子项目。
      - PrivateAssets="all"：告诉NuGet这是构建时的依赖，不要把它作为最终包的 *NuGet包依赖*。
      - 我们会让MSBuild自动把这些项目的输出DLL包含进来，而不是手动指定。
    -->
    <ProjectReference Include="../0_Contracts/0_Contracts.csproj" PrivateAssets="all" />
    <ProjectReference Include="../1_Contexts/1_Contexts.csproj" PrivateAssets="all" />
    <ProjectReference Include="../2_Infrastructure/2_Infrastructure.csproj" PrivateAssets="all" />
    <ProjectReference Include="../3_Repositories/3_Repositories.csproj" PrivateAssets="all" />
  </ItemGroup>

  <!-- ILRepack会自动合并依赖项，不需要手动包含DLL文件 -->
  <!-- 移除之前的手动打包配置，让ILRepack处理依赖项合并 -->

</Project>
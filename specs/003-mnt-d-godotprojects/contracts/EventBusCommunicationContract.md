# 事件总线通信契约

## 概述
此契约定义了在ModularGodot.Core框架中测试通过R3事件总线进行通信的预期行为。

## 契约要求

### 事件发布
- 事件总线必须成功将事件发布给所有已注册的订阅者
- 事件数据必须完整地传递给所有订阅者
- 事件发布必须是异步且非阻塞的
- 事件必须按照发送的顺序发布

### 事件订阅
- 订阅者必须接收他们订阅的事件
- 订阅者不得接收他们未订阅的事件
- 订阅管理必须允许添加和删除订阅者
- 条件订阅必须按指定方式工作

### 一次性订阅
- 一次性订阅者必须恰好接收一个事件
- 一次性订阅者在接收事件后必须自动取消订阅
- 一次性订阅不得干扰常规订阅

### 错误处理
- 一个订阅者中的异常不得影响其他订阅者
- 即使某些订阅者抛出异常，事件发布也必须继续
- 错误信息必须适当记录

### 性能要求
- 事件发布时间必须最小化（典型场景<10ms）
- 随着事件订阅的增加，内存使用量不得显著增加
- 即使有大量订阅者，订阅管理也必须高效

## 测试场景

### 成功的事件发布
**前提**：为特定事件类型注册了订阅者
**当**：通过事件总线发布该类型的事件
**则**：所有已注册的订阅者都接收到带有正确数据的事件

### 选择性订阅
**前提**：订阅者注册了不同类型的事件
**当**：为特定类型发布事件
**则**：只有该事件类型的订阅者接收到事件

### 一次性订阅
**前提**：为特定事件类型的一次性订阅者
**当**：发布多个该类型的事件
**则**：订阅者只接收到第一个事件，然后被取消订阅

### 异常隔离
**前提**：多个订阅者中有一个抛出异常
**当**：向所有订阅者发布事件
**则**：其他订阅者正常接收事件，异常得到适当处理

### 订阅管理
**前提**：订阅者后来被取消订阅
**当**：取消订阅后发布事件
**则**：被取消订阅的订阅者不接收后续事件